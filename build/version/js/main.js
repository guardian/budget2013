/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license RequireJS text 2.0.5+ Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

(function(){var e,n,t;(function(r){function o(e,n){return x.call(e,n)}function i(e,n){var t,r,o,i,a,u,c,s,l,f,p=n&&n.split("/"),d=w.map,v=d&&d["*"]||{};if(e&&"."===e.charAt(0))if(n){for(p=p.slice(0,p.length-1),e=p.concat(e.split("/")),s=0;e.length>s;s+=1)if(f=e[s],"."===f)e.splice(s,1),s-=1;else if(".."===f){if(1===s&&(".."===e[2]||".."===e[0]))break;s>0&&(e.splice(s-1,2),s-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||v)&&d){for(t=e.split("/"),s=t.length;s>0;s-=1){if(r=t.slice(0,s).join("/"),p)for(l=p.length;l>0;l-=1)if(o=d[p.slice(0,l).join("/")],o&&(o=o[r])){i=o,a=s;break}if(i)break;!u&&v&&v[r]&&(u=v[r],c=s)}!i&&u&&(i=u,a=c),i&&(t.splice(0,a,i),e=t.join("/"))}return e}function a(e,n){return function(){return d.apply(r,b.call(arguments,0).concat([e,n]))}}function u(e){return function(n){return i(n,e)}}function c(e){return function(n){m[e]=n}}function s(e){if(o(h,e)){var n=h[e];delete h[e],y[e]=!0,p.apply(r,n)}if(!o(m,e)&&!o(y,e))throw Error("No "+e);return m[e]}function l(e){var n,t=e?e.indexOf("!"):-1;return t>-1&&(n=e.substring(0,t),e=e.substring(t+1,e.length)),[n,e]}function f(e){return function(){return w&&w.config&&w.config[e]||{}}}var p,d,v,g,m={},h={},w={},y={},x=Object.prototype.hasOwnProperty,b=[].slice;v=function(e,n){var t,r=l(e),o=r[0];return e=r[1],o&&(o=i(o,n),t=s(o)),o?e=t&&t.normalize?t.normalize(e,u(n)):i(e,n):(e=i(e,n),r=l(e),o=r[0],e=r[1],o&&(t=s(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:t}},g={require:function(e){return a(e)},exports:function(e){var n=m[e];return n!==void 0?n:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:f(e)}}},p=function(e,n,t,i){var u,l,f,p,d,w,x=[];if(i=i||e,"function"==typeof t){for(n=!n.length&&t.length?["require","exports","module"]:n,d=0;n.length>d;d+=1)if(p=v(n[d],i),l=p.f,"require"===l)x[d]=g.require(e);else if("exports"===l)x[d]=g.exports(e),w=!0;else if("module"===l)u=x[d]=g.module(e);else if(o(m,l)||o(h,l)||o(y,l))x[d]=s(l);else{if(!p.p)throw Error(e+" missing "+l);p.p.load(p.n,a(i,!0),c(l),{}),x[d]=m[l]}f=t.apply(m[e],x),e&&(u&&u.exports!==r&&u.exports!==m[e]?m[e]=u.exports:f===r&&w||(m[e]=f))}else e&&(m[e]=t)},e=n=d=function(e,n,t,o,i){return"string"==typeof e?g[e]?g[e](n):s(v(e,n).f):(e.splice||(w=e,n.splice?(e=n,n=t,t=null):e=r),n=n||function(){},"function"==typeof t&&(t=o,o=i),o?p(r,e,n,t):setTimeout(function(){p(r,e,n,t)},4),d)},d.config=function(e){return w=e,w.deps&&d(w.deps,w.callback),d},t=function(e,n,t){n.splice||(t=n,n=[]),o(m,e)||o(h,e)||(h[e]=[e,n,t])},t.amd={jQuery:!0}})(),t("almond",function(){}),t("$",[],function(){return window.jQuery}),t("utils/render",[],function(){var e,n;return n=/\{\{\s*([a-zA-Z$_]+)\s*\}\}/g,e=function(e,t){var r;return r=e.replace(n,function(e,n){return void 0!==t[n]?t[n]:e})}}),t("text",["module"],function(e){var t,r,o,i,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,c=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,s="undefined"!=typeof location&&location.href,l=s&&location.protocol&&location.protocol.replace(/\:/,""),f=s&&location.hostname,p=s&&(location.port||void 0),d=[],v=e.config&&e.config()||{};return t={version:"2.0.5+",strip:function(e){if(e){e=e.replace(u,"");var n=e.match(c);n&&(e=n[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:v.createXhr||function(){var e,n,t;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(n=0;3>n;n+=1){t=a[n];try{e=new ActiveXObject(t)}catch(r){}if(e){a=[t];break}}return e},parseName:function(e){var n,t,r,o=!1,i=e.indexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return-1!==i&&(!a||i>1)?(n=e.substring(0,i),t=e.substring(i+1,e.length)):n=e,r=t||n,i=r.indexOf("!"),-1!==i&&(o="strip"===r.substring(i+1),r=r.substring(0,i),t?t=r:n=r),{moduleName:n,ext:t,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,o){var i,a,u,c=t.xdRegExp.exec(e);return c?(i=c[2],a=c[3],a=a.split(":"),u=a[1],a=a[0],!(i&&i!==n||a&&a.toLowerCase()!==r.toLowerCase()||(u||a)&&u!==o)):!0},finishLoad:function(e,n,r,o){r=n?t.strip(r):r,v.isBuild&&(d[e]=r),o(r)},load:function(e,n,r,o){if(o.isBuild&&!o.inlineText)return r(),void 0;v.isBuild=o.isBuild;var i=t.parseName(e),a=i.moduleName+(i.ext?"."+i.ext:""),u=n.toUrl(a),c=v.useXhr||t.useXhr;!s||c(u,l,f,p)?t.get(u,function(n){t.finishLoad(e,i.strip,n,r)},function(e){r.error&&r.error(e)}):n([a],function(e){t.finishLoad(i.moduleName+"."+i.ext,i.strip,e,r)})},write:function(e,n,r){if(d.hasOwnProperty(n)){var o=t.jsEscape(d[n]);r.asModule(e+"!"+n,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,n,r,o,i){var a=t.parseName(n),u=a.ext?"."+a.ext:"",c=a.moduleName+u,s=r.toUrl(a.moduleName+u)+".js";t.load(c,r,function(){var n=function(e){return o(s,e)};n.asModule=function(e,n){return o.asModule(e,s,n)},t.write(e,c,n,i)},i)}},"node"===v.env||!v.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(r=n.nodeRequire("fs"),t.get=function(e,n){var t=r.readFileSync(e,"utf8");0===t.indexOf("ï»¿")&&(t=t.substring(1)),n(t)}):"xhr"===v.env||!v.env&&t.createXhr()?t.get=function(e,n,r,o){var i,a=t.createXhr();if(a.open("GET",e,!0),o)for(i in o)o.hasOwnProperty(i)&&a.setRequestHeader(i.toLowerCase(),o[i]);v.onXhr&&v.onXhr(a,e),a.onreadystatechange=function(){var t,o;4===a.readyState&&(t=a.status,t>399&&600>t?(o=Error(e+" HTTP status: "+t),o.xhr=a,r(o)):n(a.responseText))},a.send(null)}:"rhino"===v.env||!v.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,n){var t,r,o="utf-8",i=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(i),o)),c="";try{for(t=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),t.append(r);null!==(r=u.readLine());)t.append(a),t.append(r);c=""+t+""}finally{u.close()}n(c)}:("xpconnect"===v.env||!v.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(o=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,n){var t,r,a={},u=new FileUtils.File(e);try{t=o["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),t.init(u,1,0,!1),r=o["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),r.init(t,"utf-8",t.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(t.available(),a),r.close(),t.close(),n(a.value)}catch(c){throw Error((u&&u.path||"")+": "+c)}}),t}),t("text!templates/block.html",[],function(){return"<div class='GuiBudgetBlock' >\n	<p class=\"GuiBudgetBlock_Source\">{{source}}</p>\n\n	<div class='GuiBudgetBlock_Anchor'>\n		<div class=\"GuiBudgetBlock_Button\" data-id='{{id}}'>\n			<div class=\"GuiBudgetBlock_Button_Inner\"></div>\n		</div>\n\n		<div class=\"GuiBudgetBlock_Annotation\">\n			<div class='GuiBudgetBlock_Annotation_Close'>\n				<span class='GuiBudgetBlock_Annotation_Close_Span'>x</span>\n			</div>\n\n			<h3>{{heading}}</h3>\n			<p>{{annotation}}</p>\n		</div>\n	</div>\n</div>"}),t("analytics",[],function(){var e=function(){};e.event=function(){var e=[].splice.call(arguments,0);e.splice(0,0,"_trackEvent"),o.apply(null,e)},e.pageView=function(){var e=[].splice.call(arguments,0);e.splice(0,0,"_trackPageview"),o.apply(null,e)},e.loadGA=function(e){r="guiTracker"+(new Date).getTime();var a=function(){n=window._gat._createTracker(e,r);var i=t;t=[];for(var a=0;i.length>a;++a)o(i[a]);o("_trackPageview")};i().push(a),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}()};var n=null,t=[],r="",o=function(){var e=[].splice.call(arguments,0);n?(e[0]=r+"."+e[0],i().push(e)):t.push(e)},i=function(){return window._gaq||(window._gaq=[])};return e}),t("views/AnnotationView",["$","utils/render","text!templates/block.html","analytics"],function(e,n,t,r){var o=function(o,i){var a,u,c,s,l,f,p,d,v,g;this.item=o,d=e(o.sourceEl).text(),v=e(o.annotationEl).text(),f=n(t,{id:i,source:d,annotation:v,heading:o.annotationEl.getAttribute("data-heading")}),a=e(f),u=a.find(".GuiBudgetBlock_Button"),c=a.find(".GuiBudgetBlock_Annotation_Close"),s=a.find(".GuiBudgetBlock_Anchor"),l=a.find(".GuiBudgetBlock_Source"),g=function(){if(a.toggleClass("active"),!p){var e=d.length>80?d.substr(0,80)+"...":d;r.event("click","open_panel",e,i),p=!0}},u.on("click",g),l.on("click",g),c.on("click",function(){a.removeClass("active")}),a.insertBefore(o.sourceEl),e("body").on("click",function(n){e(n.target),e.contains(a[0],n.target)||a.removeClass("active")}),o.sourceEl.parentNode.removeChild(o.sourceEl),o.annotationEl.parentNode.removeChild(o.annotationEl)};return o}),t("app",["$","views/AnnotationView","analytics"],function(e,n,t){e(function(){var r,o,i,a,u,c,s,l,f;if(r=e(".GuiBudgetSource"),o=e(".GuiBudgetAnnotation_Content"),r.length!==o.length)throw"There was a problem with the data - mismatched items";for(u=[],l=[],c=0,s=o.length;s>c;c+=1)a=r[c],i=o[c],u[c]={sourceEl:a,annotationEl:i};for(c=0,s=u.length;s>c;c+=1)l[c]=new n(u[c],c);f=e(".GuiBudgetAnnotation_Intro"),f.parent("p").remove(),f.remove(),t.loadGA("UA-25353554-13")})}),function(){var e=function(e,n,t){function r(e){w.cssText=e}function o(e,n){return typeof e===n}function i(e,n){return!!~(""+e).indexOf(n)}function a(e,n){for(var r in e){var o=e[r];if(!i(o,"-")&&w[o]!==t)return"pfx"==n?o:!0}return!1}function u(e,n,r){for(var i in e){var a=n[e[i]];if(a!==t)return r===!1?e[i]:o(a,"function")?a.bind(r||n):a}return!1}function c(e,n,t){var r=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+x.join(r+" ")+r).split(" ");return o(n,"string")||o(n,"undefined")?a(i,n):(i=(e+" "+b.join(r+" ")+r).split(" "),u(i,n,t))}var s,l,f,p="2.6.2",d={},v=!0,g=n.documentElement,m="modernizr",h=n.createElement(m),w=h.style,y=({}.toString,"Webkit Moz O ms"),x=y.split(" "),b=y.toLowerCase().split(" "),B={svg:"http://www.w3.org/2000/svg"},k={},E=[],_=E.slice,j={}.hasOwnProperty;f=o(j,"undefined")||o(j.call,"undefined")?function(e,n){return n in e&&o(e.constructor.prototype[n],"undefined")}:function(e,n){return j.call(e,n)},Function.prototype.bind||(Function.prototype.bind=function(e){var n=this;if("function"!=typeof n)throw new TypeError;var t=_.call(arguments,1),r=function(){if(this instanceof r){var o=function(){};o.prototype=n.prototype;var i=new o,a=n.apply(i,t.concat(_.call(arguments)));return Object(a)===a?a:i}return n.apply(e,t.concat(_.call(arguments)))};return r}),k.backgroundsize=function(){return c("backgroundSize")},k.svg=function(){return!!n.createElementNS&&!!n.createElementNS(B.svg,"svg").createSVGRect};for(var C in k)f(k,C)&&(l=C.toLowerCase(),d[l]=k[C](),E.push((d[l]?"":"no-")+l));return d.addTest=function(e,n){if("object"==typeof e)for(var r in e)f(e,r)&&d.addTest(r,e[r]);else{if(e=e.toLowerCase(),d[e]!==t)return d;n="function"==typeof n?n():n,v!==t&&v&&(g.className+=" "+(n?"":"no-")+e),d[e]=n}return d},r(""),h=s=null,d._version=p,d._domPrefixes=b,d._cssomPrefixes=x,d.testProp=function(e){return a([e])},d.testAllProps=c,g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(v?" js "+E.join(" "):""),d}(this,this.document);t("Modernizr",[],function(){return e})}(),function(){n.config({baseUrl:"http://interactive.guim.co.uk/2013/mar/budget/v/22/js",paths:{$:"lib/jquery.amd"}}),n(["app","Modernizr"])}(),t("main",function(){})})();